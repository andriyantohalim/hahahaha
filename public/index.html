<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DC-DC Converter Magnetic Design Assistant</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container-fluid">
        <header class="bg-primary text-white p-3 mb-4">
            <h1 class="h2 mb-0">DC-DC Converter Magnetic Design Assistant</h1>
            <p class="mb-0">Professional tool with real part numbers and feedback compensation design</p>
            
            <!-- Feature tabs -->
            <ul class="nav nav-tabs nav-tabs-dark mt-3" id="featureTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active text-white" id="magnetic-tab" data-bs-toggle="tab" data-bs-target="#magnetic" type="button" role="tab">
                        <i class="fas fa-magnet"></i> Magnetic Design
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link text-white" id="compensation-tab" data-bs-toggle="tab" data-bs-target="#compensation" type="button" role="tab">
                        <i class="fas fa-wave-square"></i> Feedback Compensation
                    </button>
                </li>
            </ul>
        </header>

        <!-- Tab content -->
        <div class="tab-content" id="featureTabContent">
            <!-- Magnetic Design Tab -->
            <div class="tab-pane fade show active" id="magnetic" role="tabpanel">
                <div class="row">
                    <!-- Input Panel -->
                    <div class="col-lg-4">
                <div class="card">
                    <div class="card-header">
                        <h5>Converter Configuration</h5>
                    </div>
                    <div class="card-body">
                        <!-- Converter Type Selection -->
                        <div class="mb-3">
                            <label for="converterType" class="form-label">Converter Type</label>
                            <select class="form-select" id="converterType" onchange="updateInputFields()">
                                <option value="buck">Buck Converter</option>
                                <option value="boost">Boost Converter</option>
                                <option value="flyback">Flyback Converter</option>
                                <option value="psfb">Phase-Shifted Full-Bridge</option>
                            </select>
                        </div>

                        <!-- Core Material Selection -->
                        <div class="mb-3">
                            <label for="coreMaterial" class="form-label">Core Material</label>
                            <select class="form-select" id="coreMaterial">
                                <option value="N87">N87 (Ferrite)</option>
                                <option value="N97">N97 (Ferrite)</option>
                                <option value="3C90">3C90 (Ferrite)</option>
                                <option value="MPP">MPP (Powder)</option>
                                <option value="Kool_Mu">Kool Mµ (Powder)</option>
                            </select>
                        </div>

                        <!-- Dynamic Input Fields -->
                        <div id="inputFields">
                            <!-- Fields will be populated by JavaScript -->
                        </div>

                        <button class="btn btn-primary w-100" onclick="calculateDesign()">Calculate Design</button>
                    </div>
                </div>

                <!-- Material Properties -->
                <div class="card mt-3">
                    <div class="card-header">
                        <h6>Selected Core Properties</h6>
                    </div>
                    <div class="card-body" id="materialProperties">
                        <!-- Material properties will be displayed here -->
                    </div>
                </div>
            </div>

            <!-- Results Panel -->
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header">
                        <h5>Design Results</h5>
                    </div>
                    <div class="card-body">
                        <div id="results" class="row">
                            <div class="col-12 text-center text-muted">
                                <p>Enter parameters and click "Calculate Design" to see results</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Part Recommendations -->
                <div class="card mt-3" id="partRecommendationsCard" style="display: none;">
                    <div class="card-header">
                        <h6><i class="fas fa-microchip"></i> Recommended Parts</h6>
                    </div>
                    <div class="card-body">
                        <div id="partRecommendations">
                            <!-- Part recommendations will be displayed here -->
                        </div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="card mt-3">
                    <div class="card-header">
                        <h6>Design Analysis</h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <canvas id="fluxChart" width="400" height="200"></canvas>
                            </div>
                            <div class="col-md-6">
                                <canvas id="lossChart" width="400" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Design Guidelines -->
                <div class="card mt-3">
                    <div class="card-header">
                        <h6>Design Guidelines & Notes</h6>
                    </div>
                    <div class="card-body">
                        <div id="designNotes">
                            <ul class="list-unstyled">
                                <li><strong>Flux Density:</strong> Keep below 80% of saturation for ferrites, 90% for powder cores</li>
                                <li><strong>Current Density:</strong> Typical range 2-6 A/mm² depending on thermal requirements</li>
                                <li><strong>Core Loss:</strong> Increases with frequency and flux density</li>
                                <li><strong>Copper Loss:</strong> Proportional to I²R, consider skin effect at high frequencies</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
                </div>
            </div>
            
            <!-- Feedback Compensation Tab -->
            <div class="tab-pane fade" id="compensation" role="tabpanel">
                <div class="row">
                    <!-- Compensation Input Panel -->
                    <div class="col-lg-4">
                        <div class="card">
                            <div class="card-header">
                                <h5>Compensation Design Parameters</h5>
                            </div>
                            <div class="card-body">
                                <!-- Compensator Type -->
                                <div class="mb-3">
                                    <label for="compensatorType" class="form-label">Compensator Type</label>
                                    <select class="form-select" id="compensatorType">
                                        <option value="type2">Type II (1 pole, 1 zero)</option>
                                        <option value="type3">Type III (2 poles, 2 zeros)</option>
                                    </select>
                                </div>
                                
                                <!-- Power Stage Parameters -->
                                <div class="mb-3">
                                    <label for="compVin" class="form-label">Input Voltage (V)</label>
                                    <input type="number" class="form-control" id="compVin" value="12" step="0.1">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="compVout" class="form-label">Output Voltage (V)</label>
                                    <input type="number" class="form-control" id="compVout" value="5" step="0.1">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="compFsw" class="form-label">Switching Frequency (kHz)</label>
                                    <input type="number" class="form-control" id="compFsw" value="100" step="1">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="compL" class="form-label">Inductance (µH)</label>
                                    <input type="number" class="form-control" id="compL" value="47" step="0.1">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="compC" class="form-label">Output Capacitance (µF)</label>
                                    <input type="number" class="form-control" id="compC" value="220" step="1">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="compESR" class="form-label">Capacitor ESR (mΩ)</label>
                                    <input type="number" class="form-control" id="compESR" value="10" step="0.1">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="compLoadCurrent" class="form-label">Load Current (A)</label>
                                    <input type="number" class="form-control" id="compLoadCurrent" value="2" step="0.1">
                                </div>
                                
                                <button type="button" class="btn btn-success w-100" onclick="calculateCompensation()">
                                    <i class="fas fa-calculator"></i> Design Compensator
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Compensation Results Panel -->
                    <div class="col-lg-8">
                        <div class="card">
                            <div class="card-header">
                                <h5>Compensation Design Results</h5>
                            </div>
                            <div class="card-body">
                                <div id="compensationResults">
                                    <p class="text-muted">Enter parameters and click "Design Compensator" to see results.</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Compensation Circuit Diagram -->
                        <div class="card mt-3">
                            <div class="card-header">
                                <h6>Compensator Circuit</h6>
                            </div>
                            <div class="card-body">
                                <div id="compensationCircuit">
                                    <canvas id="compensationChart" width="400" height="300"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Bode Plot Visualization -->
                        <div class="card mt-3">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6>Bode Plot Analysis</h6>
                                <div class="btn-group btn-group-sm" role="group">
                                    <input type="checkbox" class="btn-check" id="showPowerStage" checked>
                                    <label class="btn btn-outline-primary" for="showPowerStage">Power Stage</label>
                                    
                                    <input type="checkbox" class="btn-check" id="showCompensator" checked>
                                    <label class="btn btn-outline-success" for="showCompensator">Compensator</label>
                                    
                                    <input type="checkbox" class="btn-check" id="showLoopGain" checked>
                                    <label class="btn btn-outline-danger" for="showLoopGain">Loop Gain</label>
                                </div>
                            </div>
                            <div class="card-body">
                                <div id="bodeplotContainer">
                                    <!-- Magnitude Plot -->
                                    <div class="mb-4">
                                        <h6 class="text-center">Magnitude Response</h6>
                                        <canvas id="magnitudePlot" width="800" height="300"></canvas>
                                    </div>
                                    
                                    <!-- Phase Plot -->
                                    <div>
                                        <h6 class="text-center">Phase Response</h6>
                                        <canvas id="phasePlot" width="800" height="300"></canvas>
                                    </div>
                                    
                                    <!-- Stability Margins Display -->
                                    <div class="row mt-3">
                                        <div class="col-md-4">
                                            <div class="text-center p-2 bg-light rounded">
                                                <small class="text-muted">Crossover Frequency</small>
                                                <div class="fw-bold" id="crossoverFreq">-</div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="text-center p-2 bg-light rounded">
                                                <small class="text-muted">Phase Margin</small>
                                                <div class="fw-bold" id="phaseMargin">-</div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="text-center p-2 bg-light rounded">
                                                <small class="text-muted">Gain Margin</small>
                                                <div class="fw-bold" id="gainMargin">-</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
    <script src="app.js"></script>
</body>
</html>